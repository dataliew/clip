<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clip - English Learning Tool</title>
    
    <!-- PostHog Analytics -->
    <script>
        !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Ie Ts Ms Ee Es Rs capture Ge calculateEventProperties Os register register_once register_for_session unregister unregister_for_session js getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Ds Fs createPersonProfile Ls Ps opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing Cs debug I As getPageViewId captureTraceFeedback captureTraceMetric".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
        posthog.init('phc_lr39kW5M3OWYK0ehBhZfYali6nS9upz1oxaKHhr6DlW', {
            api_host: 'https://us.i.posthog.com',
            defaults: '2025-05-24',
            person_profiles: 'identified_only', // or 'always' to create profiles for anonymous users as well
        })
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Background gradient - static */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at top left, rgba(120, 119, 198, 0.2), transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(0, 122, 255, 0.2), transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }

        /* Landing Section */
        .landing {
            padding: 80px 40px;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-width: 900px;
            margin: 0 auto;
        }

        .app-name {
            font-size: 96px;
            font-weight: 800;
            background: linear-gradient(135deg, #0066CC, #00D4FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            letter-spacing: -2px;
        }

        .tagline {
            font-size: 36px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .english-explanation {
            font-size: 24px;
            background: linear-gradient(90deg, #00D4FF, #7B61FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .transition-text {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 40px;
            font-weight: 500;
        }

        /* Chat Preview */
        .chat-preview {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 0;
            margin-bottom: 40px;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .preview-header {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .preview-label {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .preview-messages {
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .preview-message {
            display: flex;
        }

        .preview-message.left {
            justify-content: flex-start;
        }

        .preview-message.right {
            justify-content: flex-end;
        }

        .preview-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.4;
        }

        .preview-message.left .preview-bubble {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .preview-message.right .preview-bubble {
            background: #007AFF;
            color: white;
        }

        .preview-bubble.with-input {
            padding: 16px 20px;
        }

        .preview-korean {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 12px;
        }

        .preview-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .preview-input {
            background: rgba(255, 255, 255, 0.2);
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 6px 12px;
            width: 120px;
            color: white;
            font-size: 16px;
            font-family: inherit;
        }

        .preview-answer {
            position: absolute;
            bottom: -25px;
            right: 20px;
            font-size: 14px;
            color: #00FF88;
            font-weight: 600;
            opacity: 0;
            animation: fadeInOut 4s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* Value Props */
        .value-props {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .value-prop {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 24px;
            flex: 1;
            min-width: 250px;
        }

        .value-icon {
            font-size: 24px;
        }

        .value-text {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            line-height: 1.3;
        }

        /* How it works section */
        .how-it-works {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 50px;
            padding: 0 20px;
        }

        .how-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            flex: 1;
            max-width: 200px;
        }

        .step-icon {
            font-size: 32px;
            filter: saturate(0.8);
        }

        .step-content {
            flex: 1;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #00D4FF, #7B61FF);
            border-radius: 50%;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-content p {
            font-size: 14px;
            line-height: 1.4;
            color: #ffffff;
            margin: 0;
        }

        .step-detail {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }

        .step-arrow {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .how-it-works {
                flex-direction: column;
                gap: 15px;
            }
            
            .step-arrow {
                transform: rotate(90deg);
            }
            
            .how-step {
                max-width: 100%;
                width: 100%;
            }
        }

        .cta-button {
            background: linear-gradient(135deg, #00D4FF, #7B61FF);
            color: white;
            font-size: 20px;
            font-weight: 600;
            padding: 18px 40px;
            border: none;
            border-radius: 60px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(123, 97, 255, 0.4);
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(123, 97, 255, 0.6);
        }

        .cta-button:hover::before {
            left: 100%;
        }

        @media (max-width: 768px) {
            .app-name {
                font-size: 72px;
            }
            .tagline {
                font-size: 28px;
            }
            .english-explanation {
                font-size: 20px;
            }
            .landing {
                padding: 60px 20px;
            }
        }

        /* Episode Index */
        .episode-index {
            padding: 60px 20px;
            display: none;
            min-height: 100vh;
            background: #0a0a0a;
        }

        .section-title {
            font-size: 42px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 50px;
            background: linear-gradient(90deg, #00D4FF, #7B61FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .scenario-cards {
            display: flex;
            gap: 30px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .scenario-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(123, 97, 255, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            border-color: rgba(123, 97, 255, 0.3);
            box-shadow: 0 15px 30px rgba(123, 97, 255, 0.2);
        }

        .scenario-card:hover::before {
            opacity: 1;
        }

        .scenario-icon {
            font-size: 56px;
            margin-bottom: 20px;
            filter: grayscale(0.2);
        }

        .scenario-label {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            line-height: 1.2;
        }
        
        .scenario-sublabel {
            font-size: 16px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4px;
        }

        /* Episode Grid - Vertical Netflix Style */
        .episodes-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 800px;
            margin: 0 auto;
        }

        .episode-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .episode-card:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 212, 255, 0.3);
            box-shadow: 0 15px 30px rgba(0, 212, 255, 0.2);
        }

        .episode-header {
            margin-bottom: 20px;
        }

        .episode-number {
            font-size: 48px;
            opacity: 0.3;
            font-weight: 800;
            line-height: 1;
        }

        .episode-info {
            flex: 1;
        }

        .episode-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .episode-title {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .expression-teasers {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .expression-teaser {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 14px 20px;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 400px;
        }

        .episode-card:hover .expression-teaser {
            background: rgba(255, 255, 255, 0.08);
        }

        .teaser-korean {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .teaser-hint {
            font-size: 14px;
            color: rgba(0, 212, 255, 0.8);
            font-style: italic;
        }

        .episode-context {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px 20px;
            margin-top: 16px;
        }

        .context-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .context-text {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        /* Chat Interface */
        .chat-interface {
            display: none;
            height: 100vh;
            flex-direction: column;
            background: #ffffff;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .chat-header {
            background: #f6f6f6;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .chat-header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            position: relative;
            height: 44px;
        }

        .back-button {
            position: absolute;
            left: 15px;
            color: #007AFF;
            font-size: 17px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .back-button:before {
            content: 'â€¹';
            font-size: 28px;
            font-weight: 400;
            margin-top: -3px;
        }

        .chat-header-title {
            font-weight: 600;
            font-size: 17px;
            color: #000000;
        }

        .chat-header-subtitle {
            font-size: 11px;
            color: #8e8e93;
            margin-top: 2px;
        }

        .expression-counter {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%) scale(0.9);
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 0, 0, 0.05);
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 16px;
            color: #000;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .expression-counter.show {
            opacity: 1;
            transform: translateY(-50%) scale(1);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #fff;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4);
        }
        
        .expression-count {
            font-size: 18px;
            font-weight: 800;
            transition: all 0.3s ease;
        }
        
        .expression-counter.show .expression-count {
            transform: scale(1.2);
        }

        .expression-popup {
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00FF88, #00D4FF);
            color: #0a0a0a;
            font-weight: 600;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.4);
            white-space: nowrap;
            opacity: 0;
            transform: translateY(10px) scale(0.8);
            animation: expressionPop 1.5s ease-out forwards;
            z-index: 10;
        }

        @keyframes expressionPop {
            0% {
                opacity: 0;
                transform: translateY(10px) scale(0.8);
            }
            20% {
                opacity: 1;
                transform: translateY(-5px) scale(1.1);
            }
            30% {
                transform: translateY(0) scale(1);
            }
            80% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-5px) scale(0.9);
            }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #ffffff;
        }

        .message {
            display: flex;
            align-items: flex-end;
            animation: slideUp 0.3s ease-out;
            margin-bottom: 20px;
            position: relative;
        }
        
        .message-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            align-items: flex-start;
        }
        
        .message.right .message-content {
            align-items: flex-end;
            max-width: 70%;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            margin: 0 8px;
            flex-shrink: 0;
        }
        
        .message.left .message-avatar {
            background: #E5E5EA;
            color: #3C3C43;
            order: -1;
        }
        
        .message.right .message-avatar {
            display: none;
        }
        
        .message.right .speaker-name {
            display: none;
        }
        
        .speaker-name {
            font-size: 12px;
            color: #8e8e93;
            margin-bottom: 4px;
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.left {
            justify-content: flex-start;
        }

        .message.right {
            justify-content: flex-end;
            flex-direction: column;
            align-items: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
        }

        .message.left .message-bubble {
            background: #e9e9eb;
            color: #000000;
        }

        .message.right .message-bubble {
            background: #007AFF;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .message.right .message-bubble.typing-bubble {
            background: #e9e9eb;
        }

        .message.right .message-bubble.reveal-animation {
            animation: revealPulse 0.6s ease-out;
        }

        @keyframes revealPulse {
            0% {
                transform: scale(0.95);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(0, 122, 255, 0.5);
            }
            100% {
                transform: scale(1);
                box-shadow: none;
            }
        }

        @keyframes correctPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes confidencePulse {
            0% {
                transform: translateY(-50%) scale(1);
            }
            50% {
                transform: translateY(-50%) scale(1.15);
            }
            100% {
                transform: translateY(-50%) scale(1);
            }
        }

        .success-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00FF88;
            border-radius: 50%;
            opacity: 0;
        }


        .particle:nth-child(1) { animation-delay: 0s; }
        .particle:nth-child(2) { animation-delay: 0.05s; }
        .particle:nth-child(3) { animation-delay: 0.1s; }
        .particle:nth-child(4) { animation-delay: 0.15s; }
        .particle:nth-child(5) { animation-delay: 0.2s; }
        .particle:nth-child(6) { animation-delay: 0.25s; }
        .particle:nth-child(7) { animation-delay: 0.3s; }
        .particle:nth-child(8) { animation-delay: 0.35s; }

        .particle.animate:nth-child(1) { animation: particleBurst1 0.8s ease-out forwards; }
        .particle.animate:nth-child(2) { animation: particleBurst2 0.8s ease-out forwards; }
        .particle.animate:nth-child(3) { animation: particleBurst3 0.8s ease-out forwards; }
        .particle.animate:nth-child(4) { animation: particleBurst4 0.8s ease-out forwards; }
        .particle.animate:nth-child(5) { animation: particleBurst5 0.8s ease-out forwards; }
        .particle.animate:nth-child(6) { animation: particleBurst6 0.8s ease-out forwards; }
        .particle.animate:nth-child(7) { animation: particleBurst7 0.8s ease-out forwards; }
        .particle.animate:nth-child(8) { animation: particleBurst8 0.8s ease-out forwards; }

        @keyframes particleBurst1 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(40px, 0) scale(0); opacity: 0; } }
        @keyframes particleBurst2 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(30px, -30px) scale(0); opacity: 0; } }
        @keyframes particleBurst3 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(0, -40px) scale(0); opacity: 0; } }
        @keyframes particleBurst4 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(-30px, -30px) scale(0); opacity: 0; } }
        @keyframes particleBurst5 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(-40px, 0) scale(0); opacity: 0; } }
        @keyframes particleBurst6 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(-30px, 30px) scale(0); opacity: 0; } }
        @keyframes particleBurst7 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(0, 40px) scale(0); opacity: 0; } }
        @keyframes particleBurst8 { 0% { transform: translate(0, 0) scale(0); opacity: 1; } 100% { transform: translate(30px, 30px) scale(0); opacity: 0; } }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }

        .streak-effect {
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00FF88, #00D4FF);
            transform: scaleX(0);
            transform-origin: left;
        }

        .streak-effect.animate {
            animation: streakFill 0.6s ease-out forwards;
        }

        @keyframes streakFill {
            0% {
                transform: scaleX(0);
            }
            100% {
                transform: scaleX(1);
            }
        }

        .korean-hint {
            font-size: 14px;
            color: #8e8e93;
            margin-bottom: 8px;
            padding: 4px 8px;
            background: #f2f2f7;
            border-radius: 8px;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
            animation-delay: 0.3s;
            font-style: italic;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        
        .blank-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #c7c7cc;
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .chat-controls {
            background: #f6f6f6;
            padding: 15px 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .next-button {
            width: 100%;
            background: #007AFF;
            color: white;
            font-size: 17px;
            font-weight: 600;
            padding: 14px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .next-button:hover {
            background: #0051D5;
        }

        .next-button:active {
            background: #0040A8;
        }

        .next-button:disabled {
            background: #c7c7cc;
            cursor: not-allowed;
        }

        /* Completion Screen */
        .completion-screen {
            display: none;
            padding: 40px 20px;
            text-align: center;
            min-height: 100vh;
            justify-content: center;
            flex-direction: column;
            max-width: 600px;
            margin: 0 auto;
        }

        .completion-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 40px;
            background: linear-gradient(90deg, #00FF88, #00D4FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .learned-expressions {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .expression-item {
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .expression-item:last-child {
            border-bottom: none;
        }

        .expression-korean {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
        }

        .expression-english {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            line-height: 1.4;
        }

        .submit-button {
            width: 100%;
            background: linear-gradient(135deg, #00FF88, #00D4FF);
            color: #0a0a0a;
            font-size: 18px;
            font-weight: 600;
            padding: 16px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
            margin-bottom: 20px;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.6);
        }
        
        .submit-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 0;
        }
        
        .submit-button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .try-another {
            color: #00D4FF;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .try-another:hover {
            color: #7B61FF;
        }
        
        /* Progress System */
        .progress-summary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .progress-summary::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
            animation: pulseGlow 3s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        
        .xp-container {
            font-size: 48px;
            font-weight: 700;
            color: #00FF88;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .xp-gained {
            display: inline-block;
            font-size: 32px;
            color: #00D4FF;
            margin-left: 15px;
            opacity: 0;
            transform: translateY(20px);
            animation: xpPopIn 0.6s ease-out forwards;
            animation-delay: 0.3s;
        }
        
        @keyframes xpPopIn {
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .episode-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #ffffff;
            display: block;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00FF88, #00D4FF);
            border-radius: 4px;
            width: 0%;
            animation: progressFill 1.5s ease-out forwards;
            animation-delay: 0.5s;
        }
        
        @keyframes progressFill {
            to { width: var(--progress-width); }
        }
        
        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #0a0a0a;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 15px;
            opacity: 0;
            transform: scale(0.8);
            animation: badgeAppear 0.5s ease-out forwards;
            animation-delay: 1s;
        }
        
        @keyframes badgeAppear {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes expressionPopup {
            0% {
                opacity: 0;
                transform: translateY(10px) scale(0.8);
            }
            20% {
                opacity: 1;
                transform: translateY(-5px) scale(1.1);
            }
            30% {
                transform: translateY(0) scale(1);
            }
            80% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-5px) scale(0.9);
            }
        }

        @keyframes bubbleTransform {
            0% {
                transform: scale(0.95);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(0, 122, 255, 0.5);
            }
            100% {
                transform: scale(1);
                box-shadow: none;
            }
        }


        /* Blanked text styling */
        .blanked-text {
            font-size: 16px;
            line-height: 1.5;
            color: #ffffff;
            font-weight: 400;
        }

        .message.right .typing-bubble .blanked-text {
            color: #1d1d1f;
        }

        /* Highlighted expression */
        .highlighted-expression {
            text-decoration: underline;
            text-decoration-thickness: 2px;
            text-underline-offset: 3px;
            text-decoration-color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }
        
        /* Speech Bubble Styles */
        .speech-bubble {
            background: #E8F2FF !important;
            border: 2px dashed #007AFF !important;
            color: #007AFF !important;
            cursor: pointer;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .speech-bubble:hover {
            background: #D4E8FF !important;
            transform: scale(1.02);
        }
        
        .speech-bubble.recording {
            background: #FFE5E5 !important;
            border-color: #FF3B30 !important;
            color: #FF3B30 !important;
            animation: pulse 1.5s infinite;
        }
        
        .speech-bubble.completed {
            background: #007AFF !important;
            border: 2px solid #007AFF !important;
            color: white !important;
            cursor: default;
        }
        
        .speech-bubble.completed:hover {
            transform: none;
        }
        
        .speech-prompt {
            font-weight: 600;
            font-size: 16px;
        }
        
        .answer-reference {
            margin-top: 12px;
            padding: 12px 16px;
            background: #F2F2F7;
            border-radius: 12px;
            font-size: 14px;
            opacity: 0;
            animation: fadeIn 0.4s ease-out forwards;
            animation-delay: 0.3s;
        }
        
        .reference-label {
            font-size: 12px;
            color: #8E8E93;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        .reference-text {
            color: #000;
            line-height: 1.4;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        

        /* Experience Selection */
        .experience-options {
            display: flex;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .experience-card {
            flex: 1;
            min-width: 250px;
            max-width: 300px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .experience-card:hover {
            border-color: #00D4FF;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .experience-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .experience-card h3 {
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .experience-card p {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }

        /* Scenario Preview */
        .scenario-preview {
            display: none;
            padding: 40px 20px;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: #0a0a0a;
        }

        .preview-content {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
        }

        .episode-tag {
            display: inline-block;
            background: linear-gradient(135deg, #00D4FF, #7B61FF);
            color: #0a0a0a;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .preview-title {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 30px;
            line-height: 1.3;
        }


        .speakers-box, .expressions-box, .context-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .speakers-title, .expressions-title, .context-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 15px;
        }

        .context-description {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
        }


        .speakers-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .speaker-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .speaker-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #00D4FF, #7B61FF);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .speaker-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .expressions-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .expression-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expression-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .expression-blank {
            font-size: 18px;
            font-weight: 500;
            color: #ffffff;
            line-height: 1.6;
        }

        .expression-korean {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.5;
        }

        .expression-english-hidden {
            display: inline;
        }

        .expression-blank-word {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 2px dashed rgba(255, 255, 255, 0.5);
            padding: 2px 8px;
            margin: 0 2px;
            min-width: 60px;
            text-align: center;
            color: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expression-item.revealed .expression-blank-word {
            background: transparent;
            border-bottom: none;
            color: #00FF88;
            font-weight: 600;
        }

        /* Fill in the blank styles */
        .blank-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 15px;
        }

        .blank-text {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .blank-space {
            display: inline-block;
            width: 40px;
            height: 1px;
            background: rgba(255, 255, 255, 0.4);
            vertical-align: middle;
            margin: 0 2px;
            position: relative;
            bottom: 2px;
        }

        .blank-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .blank-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 16px;
            color: #ffffff;
            outline: none;
            transition: all 0.3s ease;
        }

        .blank-input:focus {
            border-color: #007AFF;
            background: rgba(255, 255, 255, 0.15);
        }

        .blank-input.correct {
            border-color: #00FF88;
            background: rgba(0, 255, 136, 0.1);
        }

        .blank-input.incorrect {
            border-color: #FF3B30;
            background: rgba(255, 59, 48, 0.1);
        }

        .submit-answer-btn {
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-answer-btn:hover {
            background: #0051D5;
        }

        .submit-answer-btn:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
        }

        .start-conversation-btn {
            width: 100%;
            background: linear-gradient(135deg, #00D4FF, #7B61FF);
            color: white;
            font-size: 18px;
            font-weight: 600;
            padding: 16px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(123, 97, 255, 0.4);
            margin-top: 30px;
        }

        .start-conversation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(123, 97, 255, 0.6);
        }

        /* Warm-up Practice Styles */
        .warmup-practice {
            display: none;
            min-height: 100vh;
            background: #0a0a0a;
            padding: 40px 20px;
        }

        .warmup-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .warmup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .progress-indicator {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
        }

        .warmup-title {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(90deg, #00D4FF, #7B61FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .practice-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .korean-meaning {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .english-practice {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            line-height: 1.6;
            opacity: 0;
            animation: fadeInUp 0.5s ease-out 0.2s forwards;
        }

        .practice-input-container {
            display: flex;
            gap: 12px;
            max-width: 400px;
            margin: 0 auto;
            opacity: 0;
            animation: fadeInUp 0.5s ease-out 0.4s forwards;
        }

        .practice-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 14px 18px;
            font-size: 16px;
            color: #ffffff;
            outline: none;
            transition: all 0.3s ease;
        }

        .practice-input:focus {
            border-color: #00D4FF;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.2);
        }

        .practice-submit-btn {
            background: linear-gradient(135deg, #00D4FF, #7B61FF);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .practice-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(123, 97, 255, 0.4);
        }

        .practice-submit-btn:active {
            transform: translateY(0);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .encouragement-messages {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 30px;
        }

        #encouragement {
            font-size: 24px;
            font-weight: 700;
            opacity: 0;
            transform: scale(0.8);
        }

        .success-message {
            background: linear-gradient(135deg, #00FF88, #00D4AA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: successPop 0.6s ease-out forwards;
        }

        @keyframes successPop {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(10px);
            }
            50% {
                transform: scale(1.1) translateY(-5px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            font-size: 20px;
            animation: confettiFall 1s ease-out forwards;
        }

        @keyframes confettiFall {
            0% {
                opacity: 0;
                transform: translateY(-20px) rotate(0deg);
            }
            10% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Landing Section -->
        <div class="landing" id="landing">
            <h1 class="app-name">Clip</h1>
            <h2 class="tagline">The Best Way to Learn English? Live It.</h2>
            <p class="english-explanation">Experience hundreds of real situations that you couldn't even think of.<br>Just like living.</p>
            
            <p class="transition-text">Every day, practice a new real-life situation:</p>
            
            <!-- Chat Preview -->
            <div class="chat-preview">
                <div class="preview-header">
                    <span class="preview-label">Today's Situation: Weekly Team Meeting</span>
                </div>
                <div class="preview-messages">
                    <div class="preview-message left">
                        <div class="preview-bubble">How's the Q4 report coming along?</div>
                    </div>
                    <div class="preview-message right">
                        <div class="preview-bubble with-input">
                            <div class="preview-korean">ì ˆë°˜ ì •ë„ ì§„í–‰í–ˆì–´</div>
                            <div class="preview-input-wrapper">
                                <span>I'm about</span>
                                <input type="text" class="preview-input" placeholder="___" readonly>
                                <span class="preview-answer">halfway through</span>
                            </div>
                        </div>
                    </div>
                    <div class="preview-message left">
                        <div class="preview-bubble">Great! When can you have it ready?</div>
                    </div>
                </div>
            </div>
            
            <!-- Value Props -->
            <div class="value-props">
                <div class="value-prop">
                    <span class="value-icon">ðŸ’¼</span>
                    <span class="value-text">Workplace & social scenarios you face daily</span>
                </div>
                <div class="value-prop">
                    <span class="value-icon">ðŸ’ª</span>
                    <span class="value-text">Build confidence, not just vocabulary</span>
                </div>
                <div class="value-prop">
                    <span class="value-icon">ðŸŽ¯</span>
                    <span class="value-text">Learn expressions you'll use tomorrow</span>
                </div>
            </div>
            
            <div class="how-it-works">
                <div class="how-step">
                    <div class="step-content">
                        <div class="step-number">1</div>
                        <p>Pick today's situation<br><span class="step-detail">New scenario every day</span></p>
                    </div>
                </div>
                <div class="step-arrow">â†’</div>
                <div class="how-step">
                    <div class="step-content">
                        <div class="step-number">2</div>
                        <p>Practice real conversations<br><span class="step-detail">Learn expressions in context</span></p>
                    </div>
                </div>
                <div class="step-arrow">â†’</div>
                <div class="how-step">
                    <div class="step-content">
                        <div class="step-number">3</div>
                        <p>Come back tomorrow<br><span class="step-detail">Consistency builds fluency</span></p>
                    </div>
                </div>
            </div>
            
            <button class="cta-button" id="ctaButton">Start Your First Conversation</button>
        </div>

        <!-- Episode Index -->
        <div class="episode-index" id="episodeIndex" style="display: none;">
            <div class="episodes-grid" id="episodesGrid">
                <!-- Episodes will be dynamically loaded here -->
            </div>
        </div>

        <!-- Scenario Preview -->
        <div class="scenario-preview" id="scenarioPreview">
            <div class="preview-content">
                <div class="back-button" onclick="backToIndex()" style="margin-bottom: 20px;">â† Back to Episodes</div>
                <div class="episode-tag" id="episodeTag">Episode 1</div>
                <h2 class="preview-title" id="previewTitle">Title</h2>
                
                <div class="context-box">
                    <h3 class="context-title">ðŸ“ Context</h3>
                    <div class="context-description" id="contextDescription"></div>
                </div>
                
                <div class="speakers-box">
                    <h3 class="speakers-title">ðŸ’¬ Speakers</h3>
                    <div class="speakers-list" id="speakersList"></div>
                </div>
                
                <button class="start-conversation-btn" onclick="startConversation()">Start Conversation</button>
            </div>
        </div>


        <!-- Chat Interface -->
        <div class="chat-interface" id="chatInterface">
            <div class="chat-header" id="chatHeader">
                <div class="chat-header-content">
                    <div class="back-button" onclick="backToScenarios()">Back</div>
                    <div>
                        <div class="chat-header-title" id="chatHeaderTitle">Manager</div>
                        <div class="chat-header-subtitle" id="chatHeaderSubtitle">Episode 1</div>
                    </div>
                    <div class="expression-counter" id="expressionCounter">
                        <span style="font-size: 20px;">ðŸ’ª</span>
                        <span class="expression-count">0</span>
                    </div>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-controls">
                <button class="next-button" id="nextButton" onclick="nextMessage()">Next</button>
            </div>
        </div>

        <!-- Completion Screen -->
        <div class="completion-screen" id="completionScreen">
            <h2 class="completion-title">Expressions Mastered!</h2>
            <div class="progress-summary" id="progressSummary">
                <div class="xp-container">
                    <span id="totalXP">0</span> XP
                    <span class="xp-gained" id="xpGained">+50</span>
                </div>
                <div class="episode-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="episodeCount">0</span>
                        <span class="stat-label">Episodes Completed</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="expressionCount">0</span>
                        <span class="stat-label">Expressions Learned</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="achievement-badge" id="achievementBadge" style="display: none;">ðŸ† First Episode!</div>
            </div>
            <div class="learned-expressions" id="learnedExpressions"></div>
            <button class="submit-button" id="primaryAction" onclick="openWaitlist()">Get more conversations</button>
            <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <p style="font-size: 16px; color: rgba(255, 255, 255, 0.8); margin-bottom: 15px;">ðŸš€ Clip is launching soon!</p>
                <button class="submit-button secondary" onclick="openWaitlist()">Join the waitlist</button>
                <p style="font-size: 14px; color: rgba(255, 255, 255, 0.5); margin-top: 10px;">Get early access and daily conversations</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize variables
        let currentScenario = null;
        let currentEpisode = 0;
        let currentMessageIndex = 0;
        let isTyping = false;
        let learnedExpressions = [];
        let correctStreak = 0;
        let userExperienceLevel = null; // Will be set when user selects experience
        
        // Progress tracking
        let totalXP = parseInt(localStorage.getItem('clipTotalXP') || '0');
        let episodesCompleted = parseInt(localStorage.getItem('clipEpisodesCompleted') || '0');
        
        // Audio recording
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;

        // All episodes in one unified list
        const episodes = [
            {
                id: 1,
                title: "Project Status Update",
                icon: "ðŸ’¼",
                context: "Your weekly one-on-one meeting with your manager about ongoing projects.",
                speakers: ["You", "Sarah (Manager)"],
                expressions: [
                    {
                        english: "I'm about halfway through",
                        korean: "ì ˆë°˜ ì •ë„ ì§„í–‰í–ˆì–´",
                        key: "halfway through"
                    },
                    {
                        english: "That's on my radar",
                        korean: "ê·¸ê±° ì‹ ê²½ ì“°ê³  ìžˆì–´",
                        key: "on my radar"
                    }
                ],
                messages: [
                    { type: "left", text: "How's the Q4 report coming along?" },
                    { type: "right", text: "I'm about halfway through", blank: {text: "I'm about ___ ___", answer: "halfway through"} },
                    { type: "left", text: "Good. What about the budget analysis part?" },
                    { type: "right", text: "That's on my radar", blank: {text: "That's ___ ___ ___", answer: "on my radar"} },
                    { type: "left", text: "Great, just make sure it's ready by Friday." },
                    { type: "right", text: "Will do. I'll have everything wrapped up by then." }
                ]
            },
            {
                id: 2,
                title: "At a Restaurant",
                icon: "ðŸ½ï¸",
                context: "Having dinner with a friend and dealing with restaurant situations.",
                speakers: ["You", "Friend"],
                expressions: [
                    {
                        english: "It's a bit soggy",
                        korean: "ì¢€ í¼ì¡Œë„¤",
                        key: "bit soggy"
                    },
                    {
                        english: "Let's just leave it",
                        korean: "ê·¸ëƒ¥ ë„˜ì–´ê°€ìž",
                        key: "just leave it"
                    }
                ],
                messages: [
                    { type: "left", text: "What do you think of the pasta?" },
                    { type: "right", text: "It's a bit soggy", blank: {text: "It's a ___ ___", answer: "bit soggy"} },
                    { type: "left", text: "Yeah, definitely overcooked." },
                    { type: "right", text: "The flavor's okay though." },
                    { type: "left", text: "Should we say something to the waiter?" },
                    { type: "right", text: "Let's just leave it", blank: {text: "Let's ___ ___ ___", answer: "just leave it"} },
                    { type: "left", text: "Cool. How should we split the bill?" },
                    { type: "right", text: "Just split it down the middle?" }
                ]
            },
            {
                id: 3,
                title: "Clarification Needed",
                icon: "ðŸ¤”",
                context: "You approach Jennifer for help understanding a new process announced in yesterday's meeting.",
                speakers: ["You", "Jennifer (Senior Colleague)"],
                expressions: [
                    {
                        english: "I don't have a good grasp on this",
                        korean: "ìž˜ ì´í•´ ëª»í•˜ê³  ìžˆì–´",
                        key: "good grasp"
                    },
                    {
                        english: "I want to make sure we're on the same page",
                        korean: "ì´í•´í•œ ê²Œ ë§žë‚˜ í™•ì¸í•˜ê³  ì‹¶ì–´",
                        key: "same page"
                    }
                ],
                messages: [
                    { type: "right", text: "Hey Jennifer, about that new approval process..." },
                    { type: "left", text: "Yeah, what about it?" },
                    { type: "right", text: "I don't have a good grasp on this", blank: {text: "I don't have a ___ ___ on this", answer: "good grasp"} },
                    { type: "left", text: "Which part is confusing?" },
                    { type: "right", text: "The routing part. I want to make sure we're on the same page", blank: {text: "The routing part. I want to make sure we're on the ___ ___", answer: "same page"} },
                    { type: "left", text: "Sure, let me walk you through it again." }
                ]
            },
            {
                id: 4,
                title: "Progress Check",
                icon: "ðŸ“Š",
                context: "David messages you late afternoon for a quick update on the client presentation due tomorrow.",
                speakers: ["You", "David (Team Lead)"],
                expressions: [
                    {
                        english: "I'm putting the finishing touches on it",
                        korean: "ë§‰ë°”ì§€ ìž‘ì—… ì¤‘ì´ì•¼",
                        key: "finishing touches"
                    },
                    {
                        english: "I'll keep you posted",
                        korean: "ì†Œì‹ ìƒê¸°ë©´ ì•Œë ¤ì¤„ê²Œ",
                        key: "keep you posted"
                    }
                ],
                messages: [
                    { type: "left", text: "How's the client presentation looking?" },
                    { type: "right", text: "I'm putting the finishing touches on it", blank: {text: "I'm putting the ___ ___ on it", answer: "finishing touches"} },
                    { type: "left", text: "Think you'll finish today?" },
                    { type: "right", text: "Should be done within the hour." },
                    { type: "left", text: "Perfect. Send it over when you're done." },
                    { type: "right", text: "I'll keep you posted", blank: {text: "I'll ___ ___ posted", answer: "keep you"} }
                ]
            }
        ];


        function showEpisodeIndex() {
            // Track CTA click
            if (typeof posthog !== 'undefined') {
                posthog.capture('cta_clicked', {
                    button_text: "Let's improve English",
                    location: 'landing_page'
                });
            }
            
            document.getElementById('landing').style.display = 'none';
            loadEpisodeIndex();
        }

        function loadEpisodeIndex() {
            const episodesGrid = document.getElementById('episodesGrid');
            episodesGrid.innerHTML = '';
            
            episodes.forEach((episode, index) => {
                const card = document.createElement('div');
                card.className = 'episode-card';
                card.onclick = () => selectEpisode(index);
                
                card.innerHTML = `
                    <div class="episode-icon">${episode.icon}</div>
                    <div class="episode-title">Episode ${episode.id}: ${episode.title}</div>
                    <div class="episode-context">
                        <div class="context-label">Context:</div>
                        <div class="context-text">${episode.context || 'Practice everyday English expressions'}</div>
                    </div>
                `;
                
                episodesGrid.appendChild(card);
            });
            
            document.getElementById('episodeIndex').style.display = 'block';
        }

        function selectExperience(level) {
            userExperienceLevel = level;
            
            // Track experience selection
            if (typeof posthog !== 'undefined') {
                posthog.capture('experience_selected', {
                    level: level
                });
            }
            
            // Store in localStorage
            localStorage.setItem('clipExperienceLevel', level);
            
            
            document.getElementById('experienceSelection').style.display = 'none';
            showScenarioSelection();
        }

        function showScenarioSelection() {
            const scenarioDiv = document.getElementById('scenarioSelection');
            scenarioDiv.style.display = 'flex';
        }

        function getFilteredEpisodes(scenario) {
            // Get all episodes for the scenario (limited to first 5)
            const allEpisodes = conversations[scenario].episodes;
            return allEpisodes.slice(0, 5);
        }

        let currentEpisodeData = null; // Store current episode data
        
        function selectEpisode(episodeIndex) {
            currentEpisode = episodeIndex;
            currentEpisodeData = episodes[episodeIndex];
            currentMessageIndex = 0;
            learnedExpressions = [];
            correctStreak = 0;
            
            // Hide episode index and show preview
            document.getElementById('episodeIndex').style.display = 'none';
            const previewDiv = document.getElementById('scenarioPreview');
            previewDiv.style.display = 'flex';
            
            // Populate preview content
            document.getElementById('episodeTag').style.display = 'none';
            document.getElementById('previewTitle').textContent = `${currentEpisodeData.icon} Episode ${currentEpisodeData.id}: ${currentEpisodeData.title}`;
            
            // Populate speakers
            const speakersList = document.getElementById('speakersList');
            speakersList.innerHTML = '';
            currentEpisodeData.speakers.forEach(speaker => {
                const speakerDiv = document.createElement('div');
                speakerDiv.className = 'speaker-item';
                const avatarEmoji = speaker === 'You' ? 'ðŸ‘¤' : 'ðŸ’¬';
                speakerDiv.innerHTML = `
                    <div class="speaker-avatar">${avatarEmoji}</div>
                    <div class="speaker-name">${speaker}</div>
                `;
                speakersList.appendChild(speakerDiv);
            });

            // Populate context
            const contextDescription = document.getElementById('contextDescription');
            contextDescription.textContent = currentEpisodeData.context || 'Practice everyday English expressions in this conversation.';
        }

        // Warm-up practice variables
        let currentPracticeIndex = 0;
        let practiceExpressions = [];

        function startConversation() {
            document.getElementById('scenarioPreview').style.display = 'none';
            
            // Reset variables
            currentMessageIndex = 0;
            isWaitingForAnswer = false;
            currentAnswerData = null;
            isAnimating = false;
            
            // Jump directly to conversation
            document.getElementById('chatInterface').style.display = 'flex';
            
            // Update header with episode info
            document.getElementById('chatHeaderTitle').textContent = `Episode ${currentEpisodeData.id}`;
            document.getElementById('chatHeaderSubtitle').textContent = currentEpisodeData.title;
            
            document.getElementById('chatMessages').innerHTML = '';
            const nextBtn = document.getElementById('nextButton');
            nextBtn.textContent = 'Next';
            nextBtn.style.display = 'block';
            
            // Start with the first message
            showNextMessage();
        }

        function showWarmupPractice() {
            document.getElementById('warmupPractice').style.display = 'block';
            loadPracticeQuestion();
        }

        function loadPracticeQuestion() {
            if (currentPracticeIndex >= practiceExpressions.length) {
                // All practice done, start conversation
                completeWarmup();
                return;
            }

            const practice = practiceExpressions[currentPracticeIndex];
            document.getElementById('currentPractice').textContent = currentPracticeIndex + 1;
            document.getElementById('koreanMeaning').textContent = practice.korean;
            
            // Create blanked text with proper styling
            const blankText = practice.blank.replace(/_+/g, (match) => {
                return `<span style="display: inline-block; border-bottom: 2px solid #00D4FF; min-width: ${match.length * 10}px; margin: 0 4px; height: 1.2em;"></span>`;
            });
            document.getElementById('englishPractice').innerHTML = blankText;
            
            // Reset input
            const input = document.getElementById('practiceInput');
            input.value = '';
            input.disabled = false;
            input.style.background = 'rgba(255, 255, 255, 0.1)';
            input.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            input.focus();
            
            // Reset button
            const btn = document.querySelector('.practice-submit-btn');
            btn.textContent = 'Check';
            btn.onclick = checkPracticeAnswer;
            
            // Clear encouragement
            document.getElementById('encouragement').textContent = '';
            document.getElementById('encouragement').className = '';
            
            // Add enter key support
            input.onkeydown = function(e) {
                if (e.key === 'Enter' && !input.disabled) {
                    checkPracticeAnswer();
                }
            };
        }

        function checkPracticeAnswer() {
            const input = document.getElementById('practiceInput');
            const userAnswer = input.value.trim().toLowerCase();
            const correctAnswer = practiceExpressions[currentPracticeIndex].key.toLowerCase();
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
                // Disable input
                input.disabled = true;
                input.style.background = 'linear-gradient(135deg, #00FF88, #00D4AA)';
                input.style.borderColor = '#00FF88';
                input.style.color = '#ffffff';
                
                // Show encouragement
                const encouragements = ['Perfect! ðŸŽ‰', 'Excellent! â­', 'Amazing! ðŸŒŸ', 'Brilliant! âœ¨', 'Fantastic! ðŸŽŠ'];
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                const encouragementDiv = document.getElementById('encouragement');
                encouragementDiv.textContent = randomEncouragement;
                encouragementDiv.className = 'success-message';
                
                // Create confetti
                createConfetti();
                
                // Update button to continue
                const btn = document.querySelector('.practice-submit-btn');
                btn.textContent = 'Continue â†’';
                btn.onclick = () => {
                    currentPracticeIndex++;
                    loadPracticeQuestion();
                };
                
                // Auto-continue after 2 seconds
                setTimeout(() => {
                    if (currentPracticeIndex < practiceExpressions.length - 1) {
                        currentPracticeIndex++;
                        loadPracticeQuestion();
                    }
                }, 2000);
                
            } else {
                // Wrong answer feedback
                input.style.borderColor = '#FF3B30';
                input.style.animation = 'shake 0.5s ease-out';
                
                setTimeout(() => {
                    input.style.animation = '';
                    input.style.borderColor = '#00D4FF';
                    input.value = '';
                    input.focus();
                }, 500);
            }
        }

        function createConfetti() {
            const container = document.createElement('div');
            container.className = 'particle-container';
            document.body.appendChild(container);
            
            const emojis = ['ðŸŽ‰', 'â­', 'âœ¨', 'ðŸŒŸ', 'ðŸŽŠ', 'ðŸ’«', 'ðŸŽ¯', 'ðŸ”¥'];
            const colors = ['#00FF88', '#00D4FF', '#7B61FF', '#FFD700'];
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.3 + 's';
                confetti.style.fontSize = (Math.random() * 10 + 15) + 'px';
                container.appendChild(confetti);
            }
            
            setTimeout(() => container.remove(), 1500);
        }

        function completeWarmup() {
            // Show completion message
            document.querySelector('.warmup-title').textContent = "Great job! You're ready! ðŸš€";
            document.querySelector('.practice-card').innerHTML = `
                <div style="font-size: 24px; margin-bottom: 30px;">You've mastered the expressions!</div>
                <button class="practice-submit-btn" style="padding: 16px 40px; font-size: 18px;" onclick="startActualConversation()">
                    Start Conversation â†’
                </button>
            `;
        }

        function startActualConversation() {
            document.getElementById('warmupPractice').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';
            
            // Update header with episode info
            document.getElementById('chatHeaderTitle').textContent = `Episode ${currentEpisodeData.id}`;
            document.getElementById('chatHeaderSubtitle').textContent = currentEpisodeData.title;
            
            document.getElementById('chatMessages').innerHTML = '';
            const nextBtn = document.getElementById('nextButton');
            nextBtn.textContent = 'Next';
            nextBtn.disabled = false;
            nextBtn.style.opacity = '1';
            
            // Hide expression counter
            const counter = document.getElementById('expressionCounter');
            if (counter) {
                counter.classList.remove('show');
                counter.querySelector('.expression-count').textContent = '0';
            }
            
            // Automatically show the first message
            showNextMessage();
        }

        function handleOptionClick(selectedIndex, message) {
            const episode = currentEpisodeData;
            const options = document.querySelectorAll('.choice-option');
            const correctIndex = message.multipleChoice.correct;
            
            // Disable all options
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // Mark selected option
            options[selectedIndex].classList.add('selected');
            
            // Show correct/incorrect after a short delay
            setTimeout(() => {
                if (selectedIndex === correctIndex) {
                    options[selectedIndex].classList.add('correct');
                    correctStreak++;
                    
                    // Replace multiple choice with the actual message after success
                    setTimeout(() => {
                        const messages = document.getElementById('chatMessages');
                        const lastMessage = messages.lastElementChild;
                        lastMessage.innerHTML = `
                            <div class="message-content">
                                <div class="message-bubble">${message.text}</div>
                            </div>
                        `;
                        isTyping = false;
                        currentMessageIndex++;
                        
                        // Auto-progress to next message
                        setTimeout(() => {
                            if (currentMessageIndex < episode.messages.length) {
                                showNextMessage();
                            } else {
                                document.getElementById('nextButton').textContent = 'Complete';
                            }
                        }, 1000);
                    }, 800);
                } else {
                    options[selectedIndex].classList.add('incorrect');
                    options[correctIndex].classList.add('correct');
                    correctStreak = 0;
                    
                    // Show correct answer for learning
                    setTimeout(() => {
                        const messages = document.getElementById('chatMessages');
                        const lastMessage = messages.lastElementChild;
                        lastMessage.innerHTML = `
                            <div class="message-content">
                                <div class="message-bubble">${message.text}</div>
                            </div>
                        `;
                        isTyping = false;
                        currentMessageIndex++;
                        
                        // Auto-progress to next message
                        setTimeout(() => {
                            if (currentMessageIndex < episode.messages.length) {
                                showNextMessage();
                            } else {
                                document.getElementById('nextButton').textContent = 'Complete';
                            }
                        }, 1500);
                    }, 2000);
                }
            }, 300);
        }

        function showNextMessage() {
            if (currentMessageIndex >= currentEpisodeData.messages.length) {
                showCompletion();
                return;
            }

            const message = currentEpisodeData.messages[currentMessageIndex];
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.type}`;
            
            // Get speaker name
            const speakerName = message.type === 'right' ? 'You' : 
                (message.speaker || (currentScenario === 'work' ? 'Manager' : 'Friend'));
            const avatarText = speakerName.charAt(0).toUpperCase();
            
            if (message.blank) {
                // This is a line with an expression to learn - show it with blanks
                const blankText = message.blank.text.replace(/_+/g, (match) => {
                    const wordCount = match.length / 3; // Assuming 3 underscores per word
                    return `<span style="display: inline-block; border-bottom: 1px solid currentColor; opacity: 0.5; min-width: ${wordCount * 60}px; margin: 0 3px; vertical-align: baseline; height: 1.2em;"></span>`;
                });
                
                // Find the matching expression to get the Korean translation
                const matchingExpression = currentEpisodeData.expressions.find(expr => 
                    expr.key.toLowerCase() === message.blank.answer.toLowerCase()
                );
                const koreanTranslation = matchingExpression ? matchingExpression.korean : '';
                
                if (message.type === 'left') {
                    messageDiv.innerHTML = `
                        <div class="message-avatar">${avatarText}</div>
                        <div class="message-content">
                            <div class="speaker-name">${speakerName}</div>
                            <div class="message-bubble" style="background: #e9e9eb;">
                                <div class="blank-text">${blankText}</div>
                                <div style="margin-top: 8px; font-size: 14px; color: #666; font-style: italic;">${koreanTranslation}</div>
                                <div class="blank-input-container" style="margin-top: 10px;">
                                    <input type="text" class="blank-input" id="blankInput" placeholder="Type the missing words..." style="background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(0, 0, 0, 0.1); color: #000;">
                                    <button class="submit-answer-btn" onclick="checkAnswer('${message.blank.answer.replace(/'/g, "\\'")}', '${message.text.replace(/'/g, "\\'")}')">Submit</button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="blank-text" style="color: white;">${blankText}</div>
                                <div style="margin-top: 8px; font-size: 14px; color: rgba(255, 255, 255, 0.8); font-style: italic;">${koreanTranslation}</div>
                                <div class="blank-input-container" style="margin-top: 10px;">
                                    <input type="text" class="blank-input" id="blankInput" placeholder="Type the missing words..." style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 12px; border-radius: 8px; width: calc(100% - 100px); font-size: 14px;" placeholder-style="color: rgba(255, 255, 255, 0.5);">
                                    <button class="submit-answer-btn" style="background: white; color: #007AFF; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-left: 8px;" onclick="checkAnswer('${message.blank.answer.replace(/'/g, "\\'")}', '${message.text.replace(/'/g, "\\'")}')">Submit</button>
                                </div>
                                <div style="text-align: center; margin-top: 8px;">
                                    <button class="hint-button" style="background: none; border: none; color: rgba(255, 255, 255, 0.6); font-size: 13px; cursor: pointer; padding: 4px 12px; text-decoration: underline;" onclick="showHint('${message.blank.answer.replace(/'/g, "\\'")}')">
                                        Show answer
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                messagesContainer.appendChild(messageDiv);
                isWaitingForAnswer = true;
                
                // Disable Next button until answered
                const nextBtn = document.getElementById('nextButton');
                nextBtn.disabled = true;
                nextBtn.style.opacity = '0.5';
                
                // Focus on input
                setTimeout(() => {
                    const input = document.getElementById('blankInput');
                    if (input) {
                        input.focus();
                        // Add Enter key support
                        input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                checkAnswer(message.blank.answer, message.text);
                            }
                        });
                    }
                }, 100);
                
                // Store the expression for the completion screen
                learnedExpressions.push({
                    english: message.text,
                    korean: koreanTranslation
                });
                
            } else {
                // Regular message without blanks
                if (message.type === 'left') {
                    messageDiv.innerHTML = `
                        <div class="message-avatar">${avatarText}</div>
                        <div class="message-content">
                            <div class="speaker-name">${speakerName}</div>
                            <div class="message-bubble">
                                ${message.text}
                            </div>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="message-content">
                            <div class="message-bubble">
                                ${message.text}
                            </div>
                        </div>
                    `;
                }
                messagesContainer.appendChild(messageDiv);
                
                // Don't auto-increment for regular messages - wait for Next button
                if (currentMessageIndex >= episode.messages.length - 1) {
                    document.getElementById('nextButton').textContent = 'Complete';
                }
            }
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        let isWaitingForAnswer = false;
        let isAnimating = false;

        let currentAnswerData = null; // Store answer data for Next button

        function checkAnswer(correctAnswer, fullText) {
            const input = document.getElementById('blankInput');
            const userAnswer = input.value.trim().toLowerCase().replace(/[.,!?]/g, '');
            const normalizedCorrect = correctAnswer.toLowerCase().replace(/[.,!?]/g, '');
            const isCorrect = userAnswer === normalizedCorrect;
            const inputContainer = input.closest('.blank-input-container');
            
            // Store data for when Next is clicked
            currentAnswerData = {
                isCorrect: isCorrect,
                fullText: fullText,
                correctAnswer: correctAnswer
            };
            
            if (isCorrect) {
                // Get the bubble and message div
                const messageDiv = inputContainer.closest('.message');
                const bubble = messageDiv.querySelector('.message-bubble');
                
                // Immediately fill in the blanks with the full text
                const blankTextDiv = bubble.querySelector('.blank-text');
                if (blankTextDiv) {
                    blankTextDiv.textContent = fullText;
                    blankTextDiv.style.color = 'white';
                }
                
                // Remove the Korean translation
                const koreanDiv = bubble.querySelector('div[style*="font-style: italic"]');
                if (koreanDiv) {
                    koreanDiv.remove();
                }
                
                // Remove the entire input container and hint button
                inputContainer.remove();
                const hintDiv = bubble.querySelector('div:has(.hint-button)');
                if (hintDiv) {
                    hintDiv.remove();
                }
                
                // Bubble is already blue from CSS, ensure text stays white
                bubble.style.transition = 'all 0.3s ease';
                
                // Show "Correct!" popup instead of "Expression +1"
                const popup = document.createElement('div');
                popup.style.cssText = `
                    position: absolute;
                    top: -40px;
                    right: 20px;
                    background: linear-gradient(135deg, #00FF88, #00D4AA);
                    color: #ffffff;
                    font-weight: 700;
                    font-size: 18px;
                    padding: 12px 24px;
                    border-radius: 25px;
                    box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
                    opacity: 0;
                    transform: translateY(10px) scale(0.8);
                    animation: expressionPopup 1.5s ease-out forwards;
                    z-index: 100;
                `;
                popup.innerHTML = 'âœ¨ Correct!';
                messageDiv.style.position = 'relative';
                messageDiv.appendChild(popup);
                
                // Remove popup after animation
                setTimeout(() => {
                    if (popup && popup.parentNode) {
                        popup.remove();
                    }
                }, 1500);
                
                // Update confidence counter with animation
                correctStreak++;
                const counter = document.getElementById('expressionCounter');
                const countSpan = counter.querySelector('.expression-count');
                counter.classList.add('show');
                countSpan.textContent = correctStreak;
                
                // Add pulse animation
                counter.style.animation = 'confidencePulse 0.6s ease-out';
                setTimeout(() => {
                    counter.style.animation = '';
                }, 600);
                
            } else {
                // Get the bubble for hint button
                const messageDiv = inputContainer.closest('.message');
                const bubble = messageDiv.querySelector('.message-bubble');
                
                // Add shake animation and red border to input
                const inputField = document.getElementById('blankInput');
                inputField.style.borderColor = '#FF3B30';
                inputField.style.borderWidth = '2px';
                inputField.style.animation = 'shake 0.5s ease-out';
                inputField.style.transition = 'border-color 0.3s ease, border-width 0.3s ease';
                
                // Remove animation after it completes
                setTimeout(() => {
                    inputField.style.animation = '';
                }, 500);
                
                // Focus back on input for retry
                inputField.focus();
                inputField.select();
            }
            
            // Only enable Next button if answer is correct
            if (isCorrect) {
                const nextBtn = document.getElementById('nextButton');
                nextBtn.disabled = false;
                nextBtn.style.opacity = '1';
            }
        }

        function showHint(answer) {
            // Show the answer below the hint button
            const hintButton = document.querySelector('.hint-button');
            if (hintButton) {
                // Check if answer is already shown
                const existingAnswer = hintButton.parentElement.querySelector('.hint-answer');
                if (existingAnswer) {
                    return;
                }
                
                // Create answer display
                const answerDiv = document.createElement('div');
                answerDiv.className = 'hint-answer';
                answerDiv.style.cssText = `
                    color: rgba(255, 255, 255, 0.9);
                    padding: 8px 0;
                    font-size: 16px;
                    font-weight: 500;
                    animation: fadeIn 0.3s ease-out;
                `;
                answerDiv.textContent = answer;
                
                // Insert after hint button
                hintButton.parentElement.appendChild(answerDiv);
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    answerDiv.style.animation = 'fadeOut 0.3s ease-out';
                    setTimeout(() => {
                        answerDiv.remove();
                    }, 300);
                }, 3000);
                
                // Focus back on input
                const input = document.getElementById('blankInput');
                if (input) {
                    input.focus();
                    input.select();
                }
            }
        }

        function nextMessage() {
            if (isAnimating) return;
            
            // If we have answer data, process the transition first
            if (currentAnswerData && isWaitingForAnswer) {
                isAnimating = true;
                const messages = document.querySelectorAll('.message');
                const messageDiv = messages[messages.length - 1];
                const episode = currentEpisodeData;
                const message = currentEpisodeData.messages[currentMessageIndex];
                const { isCorrect, fullText } = currentAnswerData;
                
                // No need for popup here - already shown in checkAnswer
                
                // For correct answers, nothing to do - bubble already shows full text
                // For revealed answers, clean up the bubble
                if (!isCorrect && messageDiv) {
                    const bubble = messageDiv.querySelector('.message-bubble');
                    if (bubble) {
                        bubble.innerHTML = fullText;
                        bubble.style.color = 'white';
                    }
                }
                
                // Clean up state
                isWaitingForAnswer = false;
                isAnimating = false;
                currentAnswerData = null;
                
                // No need to remove hint div since it's inside the bubble now
                
                // Move to next message after a short delay
                setTimeout(() => {
                    if (currentMessageIndex < currentEpisodeData.messages.length - 1) {
                        currentMessageIndex++;
                        showNextMessage();
                    } else {
                        // Update button text if this was the last message
                        document.getElementById('nextButton').textContent = 'Complete';
                    }
                }, 500);
                
            } else {
                // Normal next behavior
                if (currentMessageIndex < currentEpisodeData.messages.length - 1) {
                    currentMessageIndex++;
                    showNextMessage();
                } else {
                    showCompletion();
                }
            }
        }

        function showCompletion() {
            document.getElementById('chatInterface').style.display = 'none';
            const completionDiv = document.getElementById('completionScreen');
            completionDiv.style.display = 'flex';
            
            // Calculate XP for this episode
            const baseXP = 50;
            const bonusXP = learnedExpressions.length * 10;
            const episodeXP = baseXP + bonusXP;
            
            // Update progress
            episodesCompleted++;
            const previousXP = totalXP;
            totalXP += episodeXP;
            
            // Save to localStorage
            localStorage.setItem('clipTotalXP', totalXP.toString());
            localStorage.setItem('clipEpisodesCompleted', episodesCompleted.toString());
            
            // Track episode completion
            if (typeof posthog !== 'undefined') {
                posthog.capture('episode_completed', {
                    scenario: currentScenario,
                    episode: currentEpisode + 1,
                    expressions_learned: learnedExpressions.length,
                    correct_streak: correctStreak,
                    xp_earned: episodeXP,
                    total_xp: totalXP,
                    total_episodes: episodesCompleted
                });
            }
            
            // Animate XP counter
            animateXPCounter(previousXP, totalXP, episodeXP);
            
            // Update stats
            document.getElementById('episodeCount').textContent = episodesCompleted;
            document.getElementById('expressionCount').textContent = episodesCompleted * 4; // Approximate
            
            // Update progress bar (max 10 episodes for full bar)
            const progressPercent = Math.min((episodesCompleted / 10) * 100, 100);
            document.getElementById('progressFill').style.setProperty('--progress-width', `${progressPercent}%`);
            
            // Show achievement badges
            if (episodesCompleted === 1) {
                document.getElementById('achievementBadge').style.display = 'inline-block';
                document.getElementById('achievementBadge').textContent = 'ðŸ† First Episode!';
            } else if (episodesCompleted === 5) {
                document.getElementById('achievementBadge').style.display = 'inline-block';
                document.getElementById('achievementBadge').textContent = 'â­ 5 Episodes Streak!';
            } else if (episodesCompleted === 10) {
                document.getElementById('achievementBadge').style.display = 'inline-block';
                document.getElementById('achievementBadge').textContent = 'ðŸ”¥ Master Learner!';
            }
            
            // Display learned expressions with title
            const expressionsContainer = document.getElementById('learnedExpressions');
            expressionsContainer.innerHTML = '<h3 style="text-align: center; font-size: 24px; margin-bottom: 24px; color: #00FF88;">ðŸŽ¯ Expressions Mastered! ðŸŽ¯</h3>';
            
            learnedExpressions.forEach(expr => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'expression-item';
                itemDiv.innerHTML = `
                    <div class="expression-english">${expr.english}</div>
                `;
                expressionsContainer.appendChild(itemDiv);
            });
            
            // Check if there's a next episode
            const hasNextEpisode = currentEpisode < episodes.length - 1;
            
            // Update completion screen content based on episode
            const completionTitle = document.querySelector('.completion-title');
            const primaryButton = document.getElementById('primaryAction');
            
            // Always show Continue button that goes back to index
            completionTitle.textContent = `Episode ${currentEpisodeData.id} Complete! ðŸŽ‰`;
            primaryButton.textContent = 'Continue';
            primaryButton.onclick = () => {
                document.getElementById('completionScreen').style.display = 'none';
                document.getElementById('episodeIndex').style.display = 'block';
            };
            primaryButton.style.background = 'linear-gradient(135deg, #00FF88, #00D4FF)';
            primaryButton.style.color = '#0a0a0a';
        }

        function openWaitlist() {
            // Track waitlist click
            if (typeof posthog !== 'undefined') {
                posthog.capture('waitlist_clicked', {
                    location: 'completion_screen',
                    expressions_learned: correctStreak,
                    scenario: currentScenario,
                    episode: currentEpisode + 1
                });
            }
            
            // Open Tally form in a popup
            window.open('https://tally.so/r/3EoZVr', 'tallyForm', 'width=600,height=700');
        }
        
        function continueToNextEpisode() {
            // Track episode continuation
            if (typeof posthog !== 'undefined') {
                posthog.capture('episode_continued', {
                    from_episode: currentEpisode + 1,
                    to_episode: currentEpisode + 2,
                    scenario: currentScenario
                });
            }
            
            // Hide completion screen
            document.getElementById('completionScreen').style.display = 'none';
            
            // Start next episode with the actual episode ID
            const nextEpisodeId = filteredEpisodes[currentEpisode + 1].id;
            startChat(currentScenario, nextEpisodeId);
        }

        function backToPreview() {
            document.getElementById('warmupPractice').style.display = 'none';
            document.getElementById('scenarioPreview').style.display = 'flex';
            currentPracticeIndex = 0;
        }

        function backToIndex() {
            document.getElementById('scenarioPreview').style.display = 'none';
            document.getElementById('episodeIndex').style.display = 'block';
        }

        function backToScenarios() {
            // Go back to preview screen
            document.getElementById('chatInterface').style.display = 'none';
            document.getElementById('scenarioPreview').style.display = 'flex';
            document.getElementById('nextButton').textContent = 'Next';
            
            // Reset progress but keep scenario
            currentMessageIndex = 0;
            isTyping = false;
            document.getElementById('chatMessages').innerHTML = '';
            
            // Hide expression counter
            const counter = document.getElementById('expressionCounter');
            if (counter) {
                counter.classList.remove('show');
            }
        }

        function animateXPCounter(start, end, gained) {
            const duration = 1500;
            const increment = (end - start) / (duration / 16);
            let current = start;
            
            const xpElement = document.getElementById('totalXP');
            const xpGainedElement = document.getElementById('xpGained');
            
            // Show gained XP
            xpGainedElement.textContent = `+${gained}`;
            
            // Animate total XP
            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }
                xpElement.textContent = Math.floor(current);
            }, 16);
        }
        
        async function toggleRecording(messageIndex) {
            const bubble = document.getElementById(`speechBubble${messageIndex}`);
            
            if (!isRecording) {
                try {
                    // Start recording
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        await processRecording(audioBlob, bubble, messageIndex);
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    bubble.classList.add('recording');
                    bubble.innerHTML = '<span class="speech-prompt">ðŸ”´ Recording... (tap to stop)</span>';
                } catch (err) {
                    console.error('Error accessing microphone:', err);
                    alert('Please allow microphone access to use this feature.');
                }
            } else {
                // Stop recording
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                isRecording = false;
                bubble.innerHTML = '<span class="speech-prompt">â³ Transcribing...</span>';
            }
        }
        
        async function processRecording(audioBlob, bubble, messageIndex) {
            try {
                // Check if we're running from file:// protocol
                const isFileProtocol = window.location.protocol === 'file:';
                
                if (isFileProtocol) {
                    // Use simulation if opened directly as file
                    console.log('Running in file mode - using simulated transcription');
                    const transcription = await simulateTranscription();
                    
                    bubble.classList.remove('recording');
                    bubble.classList.add('completed');
                    bubble.innerHTML = transcription;
                    bubble.onclick = null;
                    
                    const nextBtn = document.getElementById('nextButton');
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';
                    return;
                }
                
                // Create form data with the audio
                const formData = new FormData();
                formData.append('audio', audioBlob, 'recording.webm');
                
                // Call Vercel serverless function
                const response = await fetch('/api/transcribe', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok && data.text) {
                    // Update bubble with transcription
                    bubble.classList.remove('recording');
                    bubble.classList.add('completed');
                    bubble.innerHTML = data.text;
                    bubble.onclick = null;
                    
                    // Enable Next button
                    const nextBtn = document.getElementById('nextButton');
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';
                    
                    // Store that user has completed this speech
                } else {
                    throw new Error(data.error || 'Transcription failed');
                }
            } catch (err) {
                console.error('Transcription error:', err);
                bubble.innerHTML = '<span class="speech-prompt">âŒ Error. Tap to try again</span>';
                bubble.classList.remove('recording');
                bubble.onclick = () => toggleRecording(messageIndex);
            }
        }
        
        // Temporary function - replace with actual API call
        async function simulateTranscription() {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Return a sample transcription
            const sampleResponses = [
                "I'm just wrapping up what I was working on last week",
                "I'm just finishing up what I was working on last week",
                "I'm just completing what I was working on last week"
            ];
            return sampleResponses[Math.floor(Math.random() * sampleResponses.length)];
        }
        

        function resetApp() {
            currentScenario = null;
            currentEpisode = 0;
            currentMessageIndex = 0;
            isTyping = false;
            learnedExpressions = [];
            correctStreak = 0;
            
            document.getElementById('completionScreen').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'none';
            document.getElementById('scenarioSelection').style.display = 'none';
            document.getElementById('landing').style.display = 'flex';
            document.getElementById('nextButton').textContent = 'Next';
        }

        // Add event listener for CTA button when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const ctaButton = document.getElementById('ctaButton');
            if (ctaButton) {
                ctaButton.addEventListener('click', showEpisodeIndex);
            }
        });
    </script>
</body>
</html>
